function m({livewireKey:s,isDraggable:n=!0}){return{livewireKey:s,isDraggable:n,isDragOver:!1,isDragging:!1,onDragStart(t){this.isDragging=!0;let r=this.$el;t.dataTransfer.setData("draggable-id",r.getAttribute("data-draggable-id")),t.dataTransfer.effectAllowed="move"},onDragEnd(t){this.isDragging=!1},onDragOver(t){t.preventDefault(),this.isDragOver=!0,t.dataTransfer.dropEffect="move"},onDragLeave(t){t.currentTarget.contains(t.relatedTarget)||(this.isDragOver=!1)},onDrop(t){let r=t.dataTransfer.getData("draggable-id"),i=this.$el.getAttribute("data-draggable-id");t.preventDefault(),this.isDragOver=!1;try{r!==i?Livewire.dispatch("moveMediaItem",{livewireKey:this.livewireKey,targetId:r,toId:i}):console.warn("Cannot move item to itself:",{sourceId:r,targetId:i})}catch(o){console.error("Error parsing dragged item:",o)}}}}function p({baseUrl:s,mediaId:n,refreshLivewireEvents:t=[],refreshWindowEvents:r=[],refreshDocumentEvents:i=[],refreshKeysTracker:o=[],cacheBuster:d=!0,retryAttempts:h=3,retryDelay:l=1e3,fallbackSrc:c=null,onUpdate:f=null,onError:u=null,defaultLoadingState:g=!1}){return{src:null,baseUrl:s,mediaId:n,refreshTracker:{events:{livewire:t,window:r,document:i},monitoredKeys:o},cacheBuster:d,isLoading:g,hasError:!1,retryCount:0,retryAttempts:h,retryDelay:l,fallbackSrc:c,onUpdate:f,onError:u,generateSrc(){if(!this.baseUrl)return null;let e=this.baseUrl;if(this.cacheBuster){let a=e.includes("?")?"&":"?";e+=`${a}t=${Date.now()}`}return e},updateSrc(){this.isLoading=!0;let e=this.generateSrc();e!==this.src&&(this.src=e,this.hasError=!1,this.retryCount=0,this.onUpdate&&typeof this.onUpdate=="function"&&this.onUpdate(e,this.mediaId)),this.isLoading=!1},handleImageError(){console.warn(`Image load error for media ${this.mediaId}, attempt ${this.retryCount+1}/${this.retryAttempts}`),this.retryCount<this.retryAttempts?(this.retryCount++,setTimeout(()=>{this.updateSrc()},this.retryDelay*this.retryCount)):(this.hasError=!0,this.fallbackSrc&&(this.src=this.fallbackSrc),this.onError&&typeof this.onError=="function"&&this.onError(this.mediaId,this.retryCount),console.error(`Failed to load image for media ${this.mediaId} after ${this.retryAttempts} attempts`))},handleImageLoad(){this.isLoading=!1,this.hasError=!1,this.retryCount=0},init(){this.updateSrc(),window.Livewire&&this.refreshTracker.events.livewire.forEach(e=>{this.$wire.on(e,a=>{this.updateSrc()})}),this.refreshTracker.events.window.forEach(e=>{window.addEventListener(`${e}`,a=>{this.updateSrc()})}),this.refreshTracker.events.document.forEach(e=>{document.addEventListener(`${e}`,a=>{this.shouldRefreshForEvent(e,a.detail)&&this.updateSrc()})}),this.refreshTracker.monitoredKeys.forEach(e=>{this.$watch(e,(a,y)=>{this.updateSrc()})})},refresh(){this.updateSrc()},retry(){this.hasError=!1,this.retryCount=0,this.updateSrc()}}}document.addEventListener("alpine:init",()=>{Alpine.data("mediaItem",m),Alpine.data("dynamicImage",p)});
